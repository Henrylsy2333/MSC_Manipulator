clc;clear;
a1=0.02;a2=0.475;a3=0.02;g=9.81;
A=zeros(5000,1);
wf=0.2*pi;
filename = '.\para.txt';
[x]=textread(filename);
t=0.002:0.002:10;
%≤‚ ‘«˙œﬂ
% q0=0.5*sin(0.5*t);q1=0.5*sin(t)+0.7;q2=sin(t)+cos(2*t);
% dq0=0.25*cos(0.5*t);dq1=-0.5*cos(t);dq2=cos(t)-2*sin(2*t);
% ddq0=-0.125*sin(0.5*t);ddq1=0.5*sin(t);ddq2=-sin(t)-4*cos(2*t);
a11=x(1);b11=x(2);a21=x(3);b21=x(4);a31=x(5);b31=x(6);a41=x(7);b41=x(8);a51=x(9);b51=x(10);q10=x(11);
a12=x(12);b12=x(13);a22=x(14);b22=x(15);a32=x(16);b32=x(17);a42=x(18);b42=x(19);a52=x(20);b52=x(21);q20=x(22);
a13=x(23);b13=x(24);a23=x(25);b23=x(26);a33=x(27);b33=x(28);a43=x(29);b43=x(30);a53=x(31);b53=x(32);q30=x(33);


q0=((q10+a11/wf*sin(wf*t)-b11/wf*cos(wf*t)+a21/(2*wf)*sin(2*wf*t)-b21/(2*wf)*cos(2*wf*t)+a31/(3*wf)*sin(3*wf*t)-b31/(3*wf)*cos(3*wf*t)+a41/(4*wf)*sin(4*wf*t)-b41/(4*wf)*cos(4*wf*t)+a51/(5*wf)*sin(5*wf*t)-b51/(5*wf)*cos(5*wf*t)))*180/pi;
dq0=((a11*cos(wf*t)+b11*sin(wf*t)+a21*cos(2*wf*t)+b21*sin(2*wf*t)+a31*cos(3*wf*t)+b31*sin(3*wf*t)+a41*cos(4*wf*t)+b41*sin(4*wf*t)+a51*cos(5*wf*t)+b51*sin(5*wf*t)))*180/pi;
ddq0=((-a11*wf*sin(wf*t)+b11*wf*cos(wf*t)-a21*2*wf*sin(2*wf*t)+b21*2*wf*cos(2*wf*t)-a31*3*wf*sin(3*wf*t)+b31*3*wf*cos(3*wf*t)-a41*4*wf*sin(4*wf*t)+b41*4*wf*cos(4*wf*t)-a51*5*wf*sin(5*wf*t)+b51*5*wf*cos(5*wf*t)))*180/pi;
q1=((q20+a12/wf*sin(wf*t)-b12/wf*cos(wf*t)+a22/(2*wf)*sin(2*wf*t)-b22/(2*wf)*cos(2*wf*t)+a32/(3*wf)*sin(3*wf*t)-b32/(3*wf)*cos(3*wf*t)+a42/(4*wf)*sin(4*wf*t)-b42/(4*wf)*cos(4*wf*t)+a52/(5*wf)*sin(5*wf*t)-b52/(5*wf)*cos(5*wf*t)))*180/pi;
dq1=((a12*cos(wf*t)+b12*sin(wf*t)+a22*cos(2*wf*t)+b22*sin(2*wf*t)+a32*cos(3*wf*t)+b32*sin(3*wf*t)+a42*cos(4*wf*t)+b42*sin(4*wf*t)+a52*cos(5*wf*t)+b52*sin(5*wf*t)))*180/pi;
ddq1=((-a12*wf*sin(wf*t)+b12*wf*cos(wf*t)-a22*2*wf*sin(2*wf*t)+b22*2*wf*cos(2*wf*t)-a32*3*wf*sin(3*wf*t)+b32*3*wf*cos(3*wf*t)-a42*4*wf*sin(4*wf*t)+b42*4*wf*cos(4*wf*t)-a52*5*wf*sin(5*wf*t)+b52*5*wf*cos(5*wf*t)))*180/pi;
q2=((q30+a13/wf*sin(wf*t)-b13/wf*cos(wf*t)+a23/(2*wf)*sin(2*wf*t)-b23/(2*wf)*cos(2*wf*t)+a33/(3*wf)*sin(3*wf*t)-b33/(3*wf)*cos(3*wf*t)+a43/(4*wf)*sin(4*wf*t)-b43/(4*wf)*cos(4*wf*t)+a53/(5*wf)*sin(5*wf*t)-b53/(5*wf)*cos(5*wf*t)))*180/pi;
dq2=((a13*cos(wf*t)+b13*sin(wf*t)+a23*cos(2*wf*t)+b23*sin(2*wf*t)+a33*cos(3*wf*t)+b33*sin(3*wf*t)+a43*cos(4*wf*t)+b43*sin(4*wf*t)+a53*cos(5*wf*t)+b53*sin(5*wf*t)))*180/pi;
ddq2=((-a13*wf*sin(wf*t)+b13*wf*cos(wf*t)-a23*2*wf*sin(2*wf*t)+b23*2*wf*cos(2*wf*t)-a33*3*wf*sin(3*wf*t)+b33*3*wf*cos(3*wf*t)-a43*4*wf*sin(4*wf*t)+b43*4*wf*cos(4*wf*t)-a53*5*wf*sin(5*wf*t)+b53*5*wf*cos(5*wf*t)))*180/pi;

% Xmin2=[0.2433;
%    -0.0065;
%    -0.0035;
%    -0.0162;
%     0.0278;
%     3.5379;
%     0.5276;
%     0.4225;
%     0.0025;
%     0.0006;
%    -0.0002;
%     0.0012;
%     0.8655;
%    -0.0058;
%     0.0044;
%   147.8340;
%     5.0974;
%    89.4933;
%     2.4157;
%   377.6883;
%     0.1752];
% Xmin2=[0.2595;
%    -0.0080;
%    -0.0051;
%    -0.0181;
%     0.0345;
%     3.1957;
%     0.7064;
%     0.5055;
%     0.0028;
%     0.0000;
%    -0.0001;
%     0.0013;
%     1.0962;
%    -0.0052;
%     0.0039;
%   148.9370;
%     5.0594;
%    89.7735;
%     2.3250;
%   384.5384;
%     0.0097];
Xmin2=[ 0.2281;
   -0.0064;
   -0.0035;
   -0.0171;
    0.0283;
    3.5451;
    0.5266;
    0.4268;
    0.0024;
    0.0007;
   -0.0002;
    0.0011;
    0.8489;
   -0.0057;
    0.0046;
  148.5697;
    5.0803;
   90.1494;
    2.3764;
  379.1525;
    0.1276];
I1zz1 = ddq0;
I2xx1 = cos(q1).*(ddq0.*cos(q1) - 2*dq0.*dq1.*sin(q1));
I2xy1 = -2*dq0.*dq1.*cos(2*q1) - ddq0.*sin(2*q1);
I2xz1 = ddq1.*cos(q1) - dq1.^2.*sin(q1);
I2yy1 = sin(q1).*(2*dq0.*dq1.*cos(q1) + ddq0.*sin(q1));
I2yz1 = -(dq1.^2).*cos(q1) - ddq1.*sin(q1);
I2zz1 = A;
l2x1 = 2*a1*(dq0.*dq1.*cos(q1) + ddq0.*sin(q1));
l2y1 = 2*a1*(ddq0.*cos(q1) - dq0.*dq1.*sin(q1));
l2z1 = A;
m21 = a1^2.*ddq0;
I3xx1 = ddq0./2 + (ddq0.*cos(2*q1 + 2*q2))./2 - dq0.*dq1.*sin(2*q1 + 2*q2) - dq0.*dq2.*sin(2*q1 + 2*q2);
I3xy1 = - ddq0.*sin(2*q1 + 2*q2) - 2*dq0.*dq1.*cos(2*q1 + 2*q2) - 2*dq0.*dq2.*cos(2*q1 + 2*q2);
I3xz1 = - sin(q1 + q2).*dq1.^2 - 2*sin(q1 + q2).*dq1.*dq2 - sin(q1 + q2).*dq2.^2 + ddq1.*cos(q1 + q2) + ddq2.*cos(q1 + q2);
I3yy1 = ddq0./2 - (ddq0.*cos(2*q1 + 2*q2))./2 + dq0.*dq1.*sin(2*q1 + 2*q2) + dq0.*dq2.*sin(2*q1 + 2*q2);
I3yz1 = - cos(q1 + q2).*dq1.^2 - 2*cos(q1 + q2).*dq1.*dq2 - cos(q1 + q2).*dq2.^2 - ddq1.*sin(q1 + q2) - ddq2.*sin(q1 + q2);
I3zz1 = A;
l3x1 = 2*a1*ddq0.*sin(q1 + q2) - a2*ddq0.*cos(2*q1 + q2) + a2*ddq0.*cos(q2) + 2*a1*dq0.*dq1.*cos(q1 + q2) + 2*a1*dq0.*dq2.*cos(q1 + q2) - a2*dq0.*dq2.*sin(q2) + 2*a2*dq0.*dq1.*sin(2*q1 + q2) + a2*dq0.*dq2.*sin(2*q1 + q2);
l3y1 = a2*ddq0.*sin(2*q1 + q2) - a2*ddq0.*sin(q2) + 2*a1*ddq0.*cos(q1 + q2) - 2*a1*dq0.*dq1.*sin(q1 + q2) - 2*a1*dq0.*dq2.*sin(q1 + q2) - a2*dq0.*dq2.*cos(q2) + 2*a2*dq0.*dq1.*cos(2*q1 + q2) + a2*dq0.*dq2.*cos(2*q1 + q2);
l3z1 = a2*(sin(q1).*dq1.^2 - ddq1.*cos(q1));
m31 = (a1 + a2*sin(q1)).*(a1*ddq0 + a2*ddq0.*sin(q1) + 2*a2*dq0.*dq1.*cos(q1));
H1=[ddq0',I2xx1',I2xy1',I2xz1',I2yz1',A,l2x1',l2y1',I3xx1',I3xy1',I3xz1',I3yz1',A,l3x1',l3y1',sign(dq0)',dq0',A,A,A,A];

tol11=H1*Xmin2;

I2xx1 = dq0.^2.*cos(q1).*sin(q1);
I2xy1=dq0.^2.*cos(2*q1);
I2xz1 = ddq0.*cos(q1);
I2yy1 = -dq0.^2.*cos(q1).*sin(q1);
I2yz1 = -ddq0.*sin(q1);
I2zz1 = ddq1;
l2x1 = -a1*dq0.^2.*cos(q1) - g*sin(q1);
l2y1 = -g*cos(q1) + a1*dq0.^2.*sin(q1);
I3xx1 = (dq0.^2.*sin(2*(q1 + q2)))/2;
I3xy1 = dq0.^2.*cos(2*(q1 + q2));
I3xz1 = ddq0.*cos(q1 + q2);
I3yy1 = -0.5*dq0.^2.*sin(2*(q1 + q2));
I3yz1 = -ddq0.*sin(q1 + q2);
I3zz1 = ddq1 + ddq2;
l3x1 = 2*a2*ddq1.*cos(q2) - a1*dq0.^2.*cos(q1 + q2) - a2*dq2.^2.*sin(q2) - a2*dq0.^2.*sin(2*q1 + q2) - g*sin(q1 + q2) + a2*ddq2.*cos(q2) - 2*a2*dq1.*dq2.*sin(q2);
l3y1 = a1*dq0.^2.*sin(q1 + q2) - 2*a2*ddq1.*sin(q2) - a2*ddq2.*sin(q2) - g*cos(q1 + q2) - a2*dq2.^2.*cos(q2) - a2*dq0.^2.*cos(2*q1 + q2) - 2*a2*dq1.*dq2.*cos(q2);
l3z1 = -a2*ddq0.*cos(q1);
m31 = -a2*(-a2*ddq1 + g*sin(q1) + a1*dq0.^2.*cos(q1) + a2*dq0.^2.*cos(q1).*sin(q1));
H2=[A,I2xx1',I2xy1',I2xz1',A,I2zz1',l2x1',l2y1',I3xx1',I3xy1',I3xz1',I3yz1',I3zz1',l3x1',l3y1',A,A,sign(dq1)',dq1',A,A];

tol21=H2*Xmin2;

    
I3xx1 = 0.5*dq0.^2.*sin(2*(q1 + q2));
I3xy1 = dq0.^2.*cos(2*(q1 + q2));
I3xz1 = ddq0.*cos(q1 + q2);
I3yy1 = -0.5*dq0.^2.*sin(2*(q1 + q2));
I3yz1 = -ddq0.*sin(q1 + q2);
I3zz1 = ddq1 + ddq2;
l3x1 = sin(q2).*(a2*(dq0.^2.*sin(q1).^2 + dq1.^2) - g*cos(q1) + a1*dq0.^2.*sin(q1)) - cos(q2).*(g*sin(q1) - a2*(- cos(q1).*sin(q1).*dq0.^2 + ddq1) + a1*dq0.^2.*cos(q1));
l3y1 = sin(q2).*(g.*sin(q1) - a2*(- cos(q1).*sin(q1).*dq0.^2 + ddq1) + a1*dq0.^2.*cos(q1)) + cos(q2).*(a2.*(dq0.^2.*sin(q1).^2 + dq1.^2) - g*cos(q1) + a1*dq0.^2.*sin(q1));
H3=[A,A,A,A,A,A,A,A,I3xx1',I3xy1',I3xz1',I3yz1',I3zz1',l3x1',l3y1',A,A,A,A,sign(dq2)',dq2'];

tol31=H3*Xmin2;

filename = '.\test.txt';
[~,~,~,~,~,~,tol1,tol2,tol3]=textread(filename,'%n%n%n%n%n%n%n%n%n');
figure(1);
subplot(3,1,1);
plot(t,tol1);
subplot(3,1,2);
plot(t,tol2);
subplot(3,1,3);
plot(t,tol3);

figure(2);
subplot(3,1,1);
plot(t,tol11);
subplot(3,1,2);
plot(t,tol21);
subplot(3,1,3);
plot(t,tol31);

figure(3);
plot(t,tol11-tol1,t,tol21-tol2,t,tol31-tol3);